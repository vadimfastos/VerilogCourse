#include "text.h"


#define FONT_WIDTH 8
#define FONT_HEIGHT 16
extern unsigned char font_image[];


static unsigned cur_x, cur_y;
static color_t cur_text_color, cur_fon_color;

void text_init() {
	cur_x = 0;
	cur_y = 0;
	cur_text_color = COLOR_WHITE;
	cur_fon_color = COLOR_BLACK;
}


void text_set_pos_to_zero() {
	cur_x = 0;
	cur_y = 0;
}


void set_text_color(color_t color) {
	cur_text_color = color;
}


void set_fon_color(color_t color) {
	cur_fon_color = color;
}


void text_putchar(char symbol) {
	switch (symbol) {
		case 0:
			return;
		case '\r':
			cur_x = 0;
			break;
		case '\n':
			cur_y += FONT_HEIGHT;
			break;
		default:
			draw_simbol(cur_x, cur_y, symbol, cur_text_color, cur_fon_color);
			cur_x += FONT_WIDTH;
			break;
	}
	if (cur_x >= VGA_SCREEN_WIDTH-FONT_WIDTH) {
		cur_x = 0;
		cur_y += FONT_HEIGHT;
	}
}


void draw_simbol(unsigned x, unsigned y, char symbol, color_t text_color, color_t fon_color) {
	if ((x >= VGA_SCREEN_WIDTH-FONT_WIDTH) || (y >= VGA_SCREEN_HEIGHT-FONT_HEIGHT))
		return;
	for (int yi = 0; yi < FONT_HEIGHT; yi++)
		for (int xi = 0; xi < FONT_WIDTH; xi++) {

			/* В шрифте рисунки ASCII символов расположены последовательно, друг за другом.
				Каждый символ хранится построчно, каждый пиксель в строке занимает один бит.
				8 пикселей в строке - 1 байт, старшие биты левые пиксели, младшие - правые.
				16 строк символ - 16 байт */

			// unsigned byte_offset = symbol * 16 + yi;
			unsigned byte_offset = ( ((unsigned)symbol) << 4 ) + yi;
			unsigned bit_offset = 7 - xi;

			// Если бит, соответвующий текущей позиции, равен 0, то выводим цвет символа, иначе - цвет фона
			if (font_image[byte_offset] & (1 << bit_offset)) {
				draw_pixel(x + xi, y + yi, text_color);
			} else {
				draw_pixel(x + xi, y + yi, fon_color);
			}
		}
}


// Font RAW image (8x16)
unsigned char font_image[] = {
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x81,
	0xA5,0x81,0x81,0xBD,0x99,0x81,0x81,0x7E,0x00,0x00,
	0x00,0x00,0x00,0x00,0x7E,0xFF,0xDB,0xFF,0xFF,0xC3,
	0xE7,0xFF,0xFF,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x6C,0xFE,0xFE,0xFE,0xFE,0x7C,0x38,0x10,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x38,
	0x7C,0xFE,0x7C,0x38,0x10,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x18,0x3C,0x3C,0xE7,0xE7,0xE7,0x18,
	0x18,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,
	0x3C,0x7E,0xFF,0xFF,0x7E,0x18,0x18,0x3C,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x3C,
	0x3C,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0xE7,0xC3,0xC3,0xE7,0xFF,0xFF,
	0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x3C,
	0x66,0x42,0x42,0x66,0x3C,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xC3,0x99,0xBD,0xBD,0x99,
	0xC3,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x1E,0x0E,
	0x1A,0x32,0x78,0xCC,0xCC,0xCC,0xCC,0x78,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3C,0x66,0x66,0x66,0x66,0x3C,
	0x18,0x7E,0x18,0x18,0x00,0x00,0x00,0x00,0x00,0x00,
	0x3F,0x33,0x3F,0x30,0x30,0x30,0x30,0x70,0xF0,0xE0,
	0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x63,0x7F,0x63,
	0x63,0x63,0x63,0x67,0xE7,0xE6,0xC0,0x00,0x00,0x00,
	0x00,0x00,0x00,0x18,0x18,0xDB,0x3C,0xE7,0x3C,0xDB,
	0x18,0x18,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,
	0xF0,0xF8,0xFE,0xF8,0xF0,0xE0,0xC0,0x80,0x00,0x00,
	0x00,0x00,0x00,0x02,0x06,0x0E,0x1E,0x3E,0xFE,0x3E,
	0x1E,0x0E,0x06,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
	0x18,0x3C,0x7E,0x18,0x18,0x18,0x7E,0x3C,0x18,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x66,0x66,0x66,0x66,
	0x66,0x66,0x66,0x00,0x66,0x66,0x00,0x00,0x00,0x00,
	0x00,0x00,0x7F,0xDB,0xDB,0xDB,0x7B,0x1B,0x1B,0x1B,
	0x1B,0x1B,0x00,0x00,0x00,0x00,0x00,0x7C,0xC6,0x60,
	0x38,0x6C,0xC6,0xC6,0x6C,0x38,0x0C,0xC6,0x7C,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFE,0xFE,0xFE,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,
	0x18,0x3C,0x7E,0x18,0x18,0x18,0x7E,0x3C,0x18,0x7E,
	0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x3C,0x7E,0x18,
	0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00,0x00,
	0x00,0x00,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x7E,
	0x3C,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x18,0x0C,0xFE,0x0C,0x18,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x60,0xFE,
	0x60,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0xC0,0xC0,0xC0,0xFE,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x28,
	0x6C,0xFE,0x6C,0x28,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x10,0x38,0x38,0x7C,0x7C,0xFE,
	0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFE,0xFE,0x7C,0x7C,0x38,0x38,0x10,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x18,0x3C,0x3C,0x3C,0x18,0x18,0x18,0x00,0x18,0x18,
	0x00,0x00,0x00,0x00,0x00,0x66,0x66,0x66,0x24,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x6C,0x6C,0xFE,0x6C,0x6C,0x6C,0xFE,
	0x6C,0x6C,0x00,0x00,0x00,0x00,0x18,0x18,0x7C,0xC6,
	0xC2,0xC0,0x7C,0x06,0x06,0x86,0xC6,0x7C,0x18,0x18,
	0x00,0x00,0x00,0x00,0x00,0x00,0xC2,0xC6,0x0C,0x18,
	0x30,0x60,0xC6,0x86,0x00,0x00,0x00,0x00,0x00,0x00,
	0x38,0x6C,0x6C,0x38,0x76,0xDC,0xCC,0xCC,0xCC,0x76,
	0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x30,0x60,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x0C,0x18,0x30,0x30,0x30,0x30,0x30,0x30,
	0x18,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x18,
	0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x18,0x30,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x66,0x3C,0xFF,
	0x3C,0x66,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x18,0x18,0x18,0x30,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x06,0x0C,0x18,
	0x30,0x60,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,
	0x7C,0xC6,0xC6,0xCE,0xD6,0xE6,0xC6,0xC6,0xC6,0x7C,
	0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x38,0x78,0x18,
	0x18,0x18,0x18,0x18,0x18,0x7E,0x00,0x00,0x00,0x00,
	0x00,0x00,0x7C,0xC6,0x06,0x0C,0x18,0x30,0x60,0xC0,
	0xC6,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0xC6,
	0x06,0x06,0x3C,0x06,0x06,0x06,0xC6,0x7C,0x00,0x00,
	0x00,0x00,0x00,0x00,0x0C,0x1C,0x3C,0x6C,0xCC,0xFE,
	0x0C,0x0C,0x0C,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFE,0xC0,0xC0,0xC0,0xFC,0x06,0x06,0x06,0xC6,0x7C,
	0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x60,0xC0,0xC0,
	0xFC,0xC6,0xC6,0xC6,0xC6,0x7C,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFE,0xC6,0x06,0x06,0x0C,0x18,0x30,0x30,
	0x30,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0xC6,
	0xC6,0xC6,0x7C,0xC6,0xC6,0xC6,0xC6,0x7C,0x00,0x00,
	0x00,0x00,0x00,0x00,0x7C,0xC6,0xC6,0xC6,0x7E,0x06,
	0x06,0x06,0x0C,0x78,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,
	0x00,0x00,0x00,0x18,0x18,0x30,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x06,0x0C,0x18,0x30,0x60,0x30,0x18,
	0x0C,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x7E,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x60,0x30,0x18,0x0C,0x06,
	0x0C,0x18,0x30,0x60,0x00,0x00,0x00,0x00,0x00,0x00,
	0x7C,0xC6,0xC6,0x0C,0x18,0x18,0x18,0x00,0x18,0x18,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0xC6,0xC6,
	0xDE,0xDE,0xDE,0xDC,0xC0,0x7C,0x00,0x00,0x00,0x00,
	0x00,0x00,0x10,0x38,0x6C,0xC6,0xC6,0xFE,0xC6,0xC6,
	0xC6,0xC6,0x00,0x00,0x00,0x00,0x00,0x00,0xFC,0x66,
	0x66,0x66,0x7C,0x66,0x66,0x66,0x66,0xFC,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3C,0x66,0xC2,0xC0,0xC0,0xC0,
	0xC0,0xC2,0x66,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,
	0xF8,0x6C,0x66,0x66,0x66,0x66,0x66,0x66,0x6C,0xF8,
	0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x66,0x62,0x68,
	0x78,0x68,0x60,0x62,0x66,0xFE,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFE,0x66,0x62,0x68,0x78,0x68,0x60,0x60,
	0x60,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x66,
	0xC2,0xC0,0xC0,0xDE,0xC6,0xC6,0x66,0x3A,0x00,0x00,
	0x00,0x00,0x00,0x00,0xC6,0xC6,0xC6,0xC6,0xFE,0xC6,
	0xC6,0xC6,0xC6,0xC6,0x00,0x00,0x00,0x00,0x00,0x00,
	0x3C,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x3C,
	0x00,0x00,0x00,0x00,0x00,0x00,0x1E,0x0C,0x0C,0x0C,
	0x0C,0x0C,0xCC,0xCC,0xCC,0x78,0x00,0x00,0x00,0x00,
	0x00,0x00,0xE6,0x66,0x66,0x6C,0x78,0x78,0x6C,0x66,
	0x66,0xE6,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x60,
	0x60,0x60,0x60,0x60,0x60,0x62,0x66,0xFE,0x00,0x00,
	0x00,0x00,0x00,0x00,0xC6,0xEE,0xFE,0xFE,0xD6,0xC6,
	0xC6,0xC6,0xC6,0xC6,0x00,0x00,0x00,0x00,0x00,0x00,
	0xC6,0xE6,0xF6,0xFE,0xDE,0xCE,0xC6,0xC6,0xC6,0xC6,
	0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0xC6,0xC6,0xC6,
	0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFC,0x66,0x66,0x66,0x7C,0x60,0x60,0x60,
	0x60,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0xC6,
	0xC6,0xC6,0xC6,0xC6,0xC6,0xD6,0xDE,0x7C,0x0C,0x0E,
	0x00,0x00,0x00,0x00,0xFC,0x66,0x66,0x66,0x7C,0x6C,
	0x66,0x66,0x66,0xE6,0x00,0x00,0x00,0x00,0x00,0x00,
	0x7C,0xC6,0xC6,0x60,0x38,0x0C,0x06,0xC6,0xC6,0x7C,
	0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x7E,0x5A,0x18,
	0x18,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00,0x00,
	0x00,0x00,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,
	0xC6,0x7C,0x00,0x00,0x00,0x00,0x00,0x00,0xC6,0xC6,
	0xC6,0xC6,0xC6,0xC6,0xC6,0x6C,0x38,0x10,0x00,0x00,
	0x00,0x00,0x00,0x00,0xC6,0xC6,0xC6,0xC6,0xD6,0xD6,
	0xD6,0xFE,0xEE,0x6C,0x00,0x00,0x00,0x00,0x00,0x00,
	0xC6,0xC6,0x6C,0x7C,0x38,0x38,0x7C,0x6C,0xC6,0xC6,
	0x00,0x00,0x00,0x00,0x00,0x00,0x66,0x66,0x66,0x66,
	0x3C,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFE,0xC6,0x86,0x0C,0x18,0x30,0x60,0xC2,
	0xC6,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x30,
	0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x3C,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0x70,0x38,
	0x1C,0x0E,0x06,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
	0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,
	0x00,0x00,0x00,0x00,0x10,0x38,0x6C,0xC6,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x30,0x18,0x0C,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x0C,0x7C,
	0xCC,0xCC,0xCC,0x76,0x00,0x00,0x00,0x00,0x00,0x00,
	0xE0,0x60,0x60,0x78,0x6C,0x66,0x66,0x66,0x66,0x7C,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,
	0xC6,0xC0,0xC0,0xC0,0xC6,0x7C,0x00,0x00,0x00,0x00,
	0x00,0x00,0x1C,0x0C,0x0C,0x3C,0x6C,0xCC,0xCC,0xCC,
	0xCC,0x76,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x7C,0xC6,0xFE,0xC0,0xC0,0xC6,0x7C,0x00,0x00,
	0x00,0x00,0x00,0x00,0x1C,0x36,0x32,0x30,0x78,0x30,
	0x30,0x30,0x30,0x78,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x76,0xCC,0xCC,0xCC,0xCC,0xCC,0x7C,
	0x0C,0xCC,0x78,0x00,0x00,0x00,0xE0,0x60,0x60,0x6C,
	0x76,0x66,0x66,0x66,0x66,0xE6,0x00,0x00,0x00,0x00,
	0x00,0x00,0x18,0x18,0x00,0x38,0x18,0x18,0x18,0x18,
	0x18,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x06,
	0x00,0x0E,0x06,0x06,0x06,0x06,0x06,0x06,0x66,0x66,
	0x3C,0x00,0x00,0x00,0xE0,0x60,0x60,0x66,0x6C,0x78,
	0x78,0x6C,0x66,0xE6,0x00,0x00,0x00,0x00,0x00,0x00,
	0x38,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x3C,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xEC,
	0xFE,0xD6,0xD6,0xD6,0xD6,0xC6,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xDC,0x66,0x66,0x66,0x66,
	0x66,0x66,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x7C,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xDC,0x66,0x66,
	0x66,0x66,0x66,0x7C,0x60,0x60,0xF0,0x00,0x00,0x00,
	0x00,0x00,0x00,0x76,0xCC,0xCC,0xCC,0xCC,0xCC,0x7C,
	0x0C,0x0C,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0xDC,
	0x76,0x66,0x60,0x60,0x60,0xF0,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x7C,0xC6,0x60,0x38,0x0C,
	0xC6,0x7C,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x30,
	0x30,0xFC,0x30,0x30,0x30,0x30,0x36,0x1C,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xCC,0xCC,0xCC,
	0xCC,0xCC,0xCC,0x76,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xC6,0xC6,0xC6,0xC6,0xC6,0x6C,0x38,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC6,
	0xC6,0xD6,0xD6,0xD6,0xFE,0x6C,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xC6,0x6C,0x38,0x38,0x38,
	0x6C,0xC6,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x7E,0x06,0x0C,
	0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0xCC,0x18,
	0x30,0x60,0xC6,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0E,0x18,0x18,0x18,0x70,0x18,0x18,0x18,0x18,0x0E,
	0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x18,0x18,
	0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00,0x00,
	0x00,0x00,0x70,0x18,0x18,0x18,0x0E,0x18,0x18,0x18,
	0x18,0x70,0x00,0x00,0x00,0x00,0x00,0x76,0xDC,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x38,0x6C,0xC6,
	0xC6,0xC6,0xFE,0x00,0x00,0x00,0x00,0x00
};
